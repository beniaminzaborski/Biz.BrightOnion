version: '3.4'

services:
  sql:
    environment:
      SA_PASSWORD: "H0t0ni0n!"
      ACCEPT_EULA: "Y"
    ports:
      - "14330:1433"

  rabbit:
    ports:
      - "15672:15672"
      - "5672:5672"
    environment:
      - RABBITMQ_ERLANG_COOKIE=unique-erlang-cookie
      - RABBITMQ_NODENAME=rabbit@localhost
      - RABBITMQ_USE_LONGNAME=true
    volumes:
      #- "./rabbit-data:/var/lib/rabbitmq/mnesia"
      #- "/host_mnt/c/rabbit-data:/var/lib/rabbitmq/mnesia"
      # - "/host_mnt/c/rabbit-data:/var/lib/rabbitmq/mnesia:rw"
      - "/docker_data/rabbitmq:/var/lib/rabbitmq/mnesia"
    privileged: true

  jaeger:
    ports:
      - 5775:5775/udp
      - 5778:5778
      - 6831:6831/udp
      - 6832:6832/udp
      - 9411:9411
      - 14268:14268
      - 16686:16686
    environment:
      - COLLECTOR_ZIPKIN_HTTP_PORT=9411

  consul:
    ports:
      - 8500:8500

  web:
    ports:
      - "5000:80"

  api_gateway:
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker
      - ASPNETCORE_URLS=http://+:80
      - ASPNETCORE_HTTP_PORT=9000
    ports:
      - "9000:80"
    volumes:
      - ${APPDATA}/ASP.NET/Https:/root/.aspnet/https:ro
      - ${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro

  ordering_aggregator:
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker
      - ASPNETCORE_URLS=http://+:80
      - ASPNETCORE_HTTP_PORT=9010
    ports:
      - "9010:80"
    volumes:
      - ${APPDATA}/ASP.NET/Https:/root/.aspnet/https:ro
      - ${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro

  identity_api:
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker
      - ASPNETCORE_URLS=http://+:80
      - ASPNETCORE_HTTP_PORT=7001
    ports:
      - "7101-7110:80"
    volumes:
      - ${APPDATA}/ASP.NET/Https:/root/.aspnet/https:ro
      - ${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro

  identity_bgt:
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker

  rooms_api:
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker
      - ASPNETCORE_URLS=http://+:80
      - ASPNETCORE_HTTP_PORT=7002
    ports:
      - "7201-7210:80"
    volumes:
      - ${APPDATA}/ASP.NET/Https:/root/.aspnet/https:ro
      - ${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro

  rooms_bgt:
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker

  order_api:
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker
      - ASPNETCORE_URLS=http://+:80
      - ASPNETCORE_HTTP_PORT=7003
    ports:
      - "7301-7310:80"
    volumes:
      - ${APPDATA}/ASP.NET/Https:/root/.aspnet/https:ro
      - ${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro
    
  order_hub:
    environment:
      - ASPNETCORE_ENVIRONMENT=Docker
      - ASPNETCORE_URLS=http://+:80
      - ASPNETCORE_HTTP_PORT=7004
    ports:
      - "7401-7410:80"
    volumes:
      - ${APPDATA}/ASP.NET/Https:/root/.aspnet/https:ro
      - ${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro

#  analytics_api:
#    environment:
#      - ASPNETCORE_ENVIRONMENT=Development
#      - ASPNETCORE_URLS=https://+:443;http://+:80
#      - ASPNETCORE_HTTPS_PORT=44329
#    ports:
#      - "57534:80"
#      - "44329:443"
#    volumes:
#      - ${APPDATA}/ASP.NET/Https:/root/.aspnet/https:ro
#      - ${APPDATA}/Microsoft/UserSecrets:/root/.microsoft/usersecrets:ro

# volumes:
  # rabbitmq:
    # driver: local
